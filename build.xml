<project name="Sample usage of Salesforce Ant tasks"
		 default="describeMetadata"
		 basedir="."
         xmlns:sf="antlib:com.salesforce">

    <taskdef resource="net/sf/antcontrib/antlib.xml"/>
  <property file="build.properties"/>
    <macrodef name="timestamp.echo">
        <attribute name="message"/>
        <sequential>
            <local name="current.time" />
            <tstamp>
                <format property="current.time" pattern="dd/MM/yyyy hh:mm:ss"/>
            </tstamp>
            <echo message="${current.time} @{message}" />
        </sequential>
    </macrodef>

    <property environment="env"/>

    <!-- Test out deploy and retrieve verbs for package 'mypkg' -->
    <target name="test">
        <!-- Upload the contents of the "mypkg" package -->
        <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" deployRoot="mypkg"/>
        <mkdir dir="retrieveOutput"/>
        <!-- Retrieve the contents into another directory -->
        <sf:retrieve username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}"
                     retrieveTarget="retrieveOutput" packageNames="MyPkg"/>
    </target>

    <!-- Retrieve an unpackaged set of metadata from your org -->
    <!-- The file unpackaged/package.xml lists what is to be retrieved -->
    <target name="retrieveUnpackaged">
        <timestamp.echo message="started*************"/>
        <if>
            <available file="${sf.retrieveTarget}" type="dir"/>
            <then>
                <echo message="Directory exists"/>
            </then>
            <else>
                <echo message="Directory does not exist"/>
                <mkdir dir="${sf.retrieveTarget}"/>
            </else>
        </if>

        <!-- Retrieve the contents into another directory -->
        <sf:retrieve username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}"
                     retrieveTarget="${sf.retrieveTarget}" unpackaged="${sf.unpackaged}" trace="false"/>
        <timestamp.echo message="finished*************"/>
    </target>

    <!--    &lt;!&ndash; Retrieve all the items of a particular metadata type &ndash;&gt;
    <target name="bulkRetrieve">
      <sf:bulkRetrieve username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" metadataType="${sf.metadataType}" retrieveTarget="retrieveUnpackaged"/>
    </target>-->

    <!-- Retrieve metadata for all the packages specified under packageNames -->
    <target name="retrievePkg">
        <sf:retrieve username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}"
                     retrieveTarget="retrieveOutput" packageNames="${sf.pkgName}"/>
    </target>

    
      <target name="deployUnpackaged">
        <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" deployRoot="${sf.retrieveTarget}"/>
      </target>

    
      <target name="deployZip">
        <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" zipFile="${sf.zipFile}" pollWaitMillis="1000"/>
      </target>


    <!-- Shows deploying code & running tests for code in directory -->
    <!--  <target name="deployCode">
          &lt;!&ndash; Upload the contents of the "codepkg" directory, running the tests for just 1 class &ndash;&gt;
          <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" deployRoot="codepkg">
            <runTest>SampleDeployClass</runTest>
          </sf:deploy>
        </target>
    -->
    <!--  &lt;!&ndash; Shows removing code; only succeeds if done after deployCode &ndash;&gt;
    <target name="undeployCode">
      <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" deployRoot="removecodepkg"/>
    </target>-->

    <!--
        &lt;!&ndash; Shows retrieving code; only succeeds if done after deployCode &ndash;&gt;
        <target name="retrieveCode">
          &lt;!&ndash; Retrieve the contents listed in the file codepkg/package.xml into the codepkg directory &ndash;&gt;
          <sf:retrieve username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" retrieveTarget="codepkg" unpackaged="codepkg/package.xml"/>
        </target>

        &lt;!&ndash; Shows deploying code, running all tests, and running tests (1 of which fails), and logging. &ndash;&gt;
        <target name="deployCodeFailingTest">
          &lt;!&ndash; Upload the contents of the "codepkg" package, running all tests &ndash;&gt;
          <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" deployRoot="codepkg" runAllTests="true" logType="Debugonly"/>
        </target>

        &lt;!&ndash; Shows check only; never actually saves to the server &ndash;&gt;
        <target name="deployCodeCheckOnly">
          <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" deployRoot="codepkg" checkOnly="true"/>
        </target>
    -->

    <!-- Retrieve the information of all items of a particular metadata type -->
    <target name="listMetadata">
        <sf:listMetadata username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}"
                         metadataType="${sf.metadataType}"/>
    </target>

    <!-- Retrieve the information on all supported metadata type -->
    <target name="describeMetadata">
        <sf:describeMetadata username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}"/>
    </target>
</project>
